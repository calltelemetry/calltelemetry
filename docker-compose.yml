version: "3"
services:
  traceroute:
    image: "calltelemetry/traceroute:0.6.7"
    user: root
    expose: [4100]
    ports: ["4100:4100"]
  db:
    image: "bitnami/postgresql:latest"
    user: root
    restart: "always"
    environment:
      - POSTGRES_USER=calltelemetry
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_DB=calltelemetry_prod
    expose: [5432]
    volumes:
      - ./postgres-data:/bitnami/postgresql
  web:
    image: "calltelemetry/web:0.6.7"
    restart: "always"
    ports: ["80:4080", "443:4001", "22:3022"]
    environment:
      - DB_USER=calltelemetry
      - DB_PASSWORD=postgres
      - DB_HOSTNAME=db
      - DB_NAME=calltelemetry_prod
      - DB_PORT=5432
      - EXTERNAL_PORT=80
      - HOSTNAME=$DEFAULT_IPV4
      - EXTERNAL_IP=$DEFAULT_IPV4
      - LANG=en_US.UTF-8
      - LANGUAGE=en_US:en
      - LC_ALL=en_US.UTF-8
      # - EXTERNAL_IP=localhost
      - CDR_ROOT_PATH=/sftp
      - LOGGING_LEVEL=debug
    volumes:
      - ./sftp:/sftp
      - ./ctconfig:/home/app/ctconfig
